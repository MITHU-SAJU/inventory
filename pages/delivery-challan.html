<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add delivery challan</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">

</head>

<body>
    <!-- MAIN DASHBOARD WRAPPER -->
    <div class="d-flex">

        <!-- Sidebar Component -->
        <div include-html="../components/sidebar.html"></div>

        <!-- MAIN CONTENT -->
        <main class="main p-4 flex-grow-1">

            <!-- Header -->
            <header class="d-flex justify-content-between align-items-center mb-3 px-3 py-1 header-bar">

                <h2>Add Delivery Challan</h2>

                <!-- Profile Dropdown -->
                <div class="dropdown">
                    <button class="btn border-0 d-flex align-items-center" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle fs-2"></i>
                    </button>

                    <ul class="dropdown-menu dropdown-menu-end shadow">
                        <li><a class="dropdown-item" href="#">My Profile</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-danger" href="#">Logout</a></li>
                    </ul>
                </div>
            </header>

            <div class="container-fluid py-3">

                <!-- ================================================= -->
                <!-- 1. CUSTOMER DETAILS                               -->
                <!-- ================================================= -->
                <div class="card shadow-sm p-4" style="border-radius: 16px;">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3">Customer Details</h6>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <select class="form-select">
                                    <option selected disabled>Select Customer</option>
                                    <option>ABC Textiles</option>
                                    <option>XYZ Garments</option>
                                    <option>Retail Hub</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <input class="form-control" placeholder="Customer Address" readonly>
                            </div>
                        </div>

                    </div>
                </div>


                <!-- ================================================= -->
                <!-- 2. PRODUCT ENTRY                                  -->
                <!-- ================================================= -->
                <div class="card shadow-sm p-4" style="border-radius: 16px;">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3">Add Product</h6>

                        <div class="row g-3 align-items-end">

                            <div class="col-md-5">
                                <select class="form-select" id="product">
                                    <option disabled selected>Product / Style Code</option>
                                    <option>PRD-001</option>
                                    <option>PRD-002</option>
                                </select>
                            </div>

                            <div class="col-md-4 d-flex gap-2">
                                <select class="form-select" id="color">
                                    <option disabled selected>Color</option>
                                    <option>Black</option>
                                    <option>White</option>
                                    <option>Blue</option>
                                </select>

                                <select class="form-select" id="size">
                                    <option disabled selected>Size</option>
                                    <option>S</option>
                                    <option>M</option>
                                    <option>L</option>
                                    <option>XL</option>
                                </select>
                            </div>

                            <div class="col-md-3 d-flex gap-2 align-items-center">
                                <input type="number" id="qty" class="form-control" placeholder="Qty">

                                <button class="add-box-btn" onclick="addItem()" title="Add Item">
                                    <i class="bi bi-plus-lg"></i>
                                </button>
                            </div>

                        </div>

                    </div>
                </div>


                <!-- ================================================= -->
                <!-- 3. ITEM DETAILS TABLE                             -->
                <!-- ================================================= -->
                <div class="card shadow-sm p-4" style="border-radius: 16px;">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3">Item Details</h6>

                        <div class="table-responsive">
                            <table class="table table-bordered align-middle text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>Product / Style Code</th>
                                        <th>Color</th>
                                        <th>Size</th>
                                        <th>Qty</th>
                                    </tr>
                                </thead>

                                <tbody id="itemTableBody">
                                    <!-- JS rows -->
                                </tbody>

                                <tfoot>
                                    <tr class="fw-bold">
                                        <td colspan="4" class="text-end">Total Qty</td>
                                        <td id="totalQty">0</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                    </div>
                </div>


                <!-- ================================================= -->
                <!-- 4. SIGNATURES                                     -->
                <!-- ================================================= -->
                <div class="card shadow-sm p-4" style="border-radius: 16px;">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3">Signatures</h6>

                        <div class="row g-4">

                            <div class="col-md-6">
                                <div class="signature-box">
                                    <canvas id="receiverSign"></canvas>
                                </div>
                                <small class="text-muted d-block mt-1">Receiver Signature</small>
                                <button class="btn btn-sm btn-outline-secondary mt-2"
                                    onclick="clearSignature('receiverSign')">Clear</button>
                            </div>

                            <div class="col-md-6">
                                <div class="signature-box">
                                    <canvas id="authSign"></canvas>
                                </div>
                                <small class="text-muted d-block mt-1">Authorized Signature</small>
                                <button class="btn btn-sm btn-outline-secondary mt-2"
                                    onclick="clearSignature('authSign')">Clear</button>
                            </div>

                        </div>

                    </div>
                </div>


                <!-- ================================================= -->
                <!-- 5. VEHICLE DISPATCH DETAILS                       -->
                <!-- ================================================= -->
                <div class="card shadow-sm p-4" style="border-radius: 16px;">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3">Vehicle Dispatch Details</h6>

                        <div class="row g-3">
                            <div class="col-md-3">
                                <input class="form-control" placeholder="Vehicle Number">
                            </div>

                            <div class="col-md-3">
                                <input class="form-control" placeholder="Transporter Name">
                            </div>

                            <div class="col-md-3">
                                <input class="form-control" placeholder="Driver Contact">
                            </div>

                            <div class="col-md-3">
                                <input type="datetime-local" class="form-control">
                            </div>
                        </div>

                    </div>
                </div>


                <!-- ================================================= -->
                <!-- 6. ACTION                                        -->
                <!-- ================================================= -->
                <div class="text-center">
                    <button class="btn btn-primary px-5 py-2 fw-semibold">
                        Save Delivery Challan
                    </button>
                </div>

            </div>


        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- INCLUDE HTML -->
    <script src="../assets/js/include.js"></script>

    <!-- CUSTOM DASHBOARD JS -->
    <script src="../assets/js/script.js"></script>
    <script>
        let rowCount = 0;
        let totalQty = 0;

        function addItem() {

            const product = document.getElementById("product").value;
            const color = document.getElementById("color").value;
            const size = document.getElementById("size").value;
            const qty = document.getElementById("qty").value;

            if (!product || !color || !size || !qty || qty <= 0) {
                alert("Please fill all product details");
                return;
            }

            rowCount++;
            totalQty += parseInt(qty);

            const tableBody = document.getElementById("itemTableBody");

            const row = `
        <tr>
            <td>${rowCount}</td>
            <td>${product}</td>
            <td>${color}</td>
            <td>${size}</td>
            <td>${qty}</td>
        </tr>
    `;

            tableBody.insertAdjacentHTML("beforeend", row);

            document.getElementById("totalQty").innerText = totalQty;

            // Reset inputs
            document.getElementById("product").selectedIndex = 0;
            document.getElementById("color").selectedIndex = 0;
            document.getElementById("size").selectedIndex = 0;
            document.getElementById("qty").value = "";
        }
    </script>

    <script>
        function initSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext("2d");

            // Set proper resolution
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2;
            ctx.lineCap = "round";

            let drawing = false;

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                if (e.touches) {
                    return {
                        x: e.touches[0].clientX - rect.left,
                        y: e.touches[0].clientY - rect.top
                    };
                }
                return {
                    x: e.offsetX,
                    y: e.offsetY
                };
            };

            const startDraw = (e) => {
                drawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            };

            const draw = (e) => {
                if (!drawing) return;
                e.preventDefault();
                const pos = getPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            };

            const stopDraw = () => {
                drawing = false;
                ctx.beginPath();
            };

            // Mouse events
            canvas.addEventListener("mousedown", startDraw);
            canvas.addEventListener("mousemove", draw);
            canvas.addEventListener("mouseup", stopDraw);
            canvas.addEventListener("mouseleave", stopDraw);

            // Touch events
            canvas.addEventListener("touchstart", startDraw);
            canvas.addEventListener("touchmove", draw);
            canvas.addEventListener("touchend", stopDraw);
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Init both signatures
        window.onload = () => {
            initSignature("receiverSign");
            initSignature("authSign");
        };
    </script>





</body>

</html>